<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control IoT Global - Sci-Fi</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --neon-cyan: #06b6d4;
            --neon-blue: #3b82f6;
        }

        body {
            background-color: #020617;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .bg-cyber {
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #020617 100%);
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        .grid-overlay {
            background-image: linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(6, 182, 212, 0.2);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .glow-active {
            box-shadow: 0 0 15px #fbbf24;
            border-color: #fbbf24 !important;
            color: #fbbf24;
        }

        .btn-control {
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }
        
        .disabled-mode {
            opacity: 0.4;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="bg-cyber"></div>
    <div class="grid-overlay"></div>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-black text-cyan-400 mb-2 tracking-widest uppercase">Cloud Control IoT</h1>
            <div class="h-1 w-32 bg-cyan-500 mx-auto rounded-full shadow-[0_0_10px_#06b6d4]"></div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <div class="glass-card p-6 rounded-2xl">
                <div class="flex items-center mb-4">
                    <i data-lucide="cpu" class="text-cyan-400 mr-2"></i>
                    <h2 class="text-xl font-bold">Estado General</h2>
                </div>
                <div id="status-container" class="space-y-4">
                    <div class="flex justify-between items-center bg-slate-900/50 p-3 rounded-lg">
                        <span>Modo Operación:</span>
                        <span id="mode-text" class="text-cyan-400 font-mono">CARGANDO...</span>
                    </div>
                </div>
            </div>

            <div id="controls-section" class="glass-card p-6 rounded-2xl lg:col-span-2">
                <div class="flex items-center mb-6">
                    <i data-lucide="zap" class="text-yellow-400 mr-2"></i>
                    <h2 class="text-xl font-bold">Controles de Actuadores</h2>
                </div>
                
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <button onclick="toggleActuator('led')" id="btn-led" class="btn-control p-4 glass-card rounded-xl flex flex-col items-center hover:bg-cyan-900/30">
                        <i data-lucide="lightbulb" class="mb-2"></i>
                        <span>LED</span>
                    </button>
                    <button onclick="toggleActuator('motor')" id="btn-motor" class="btn-control p-4 glass-card rounded-xl flex flex-col items-center hover:bg-cyan-900/30">
                        <i data-lucide="fan" class="mb-2"></i>
                        <span>MOTOR</span>
                    </button>
                    </div>
            </div>
        </div>
    </div>

    <script>
        // 1. CONFIGURACIÓN FIREBASE (Reemplaza con tus datos reales)
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            databaseURL: "https://TU_PROYECTO-default-rtdb.firebaseio.com",
            projectId: "TU_PROYECTO",
            storageBucket: "TU_PROYECTO.appspot.com",
            messagingSenderId: "ID_SENDER",
            appId: "ID_APP"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. LÓGICA DE INTERFAZ
        lucide.createIcons();

        // Escuchar cambios en tiempo real
        db.ref('sistema').on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // Actualizar texto de modo
            const modeText = document.getElementById('mode-text');
            modeText.innerText = data.modo.toUpperCase();

            // Bloquear controles si está en modo AUTO
            const controls = document.getElementById('controls-section');
            if (data.modo === 'auto') {
                controls.classList.add('disabled-mode');
                modeText.className = 'text-yellow-400 animate-pulse';
            } else {
                controls.classList.remove('disabled-mode');
                modeText.className = 'text-green-400';
            }

            // Actualizar estados visuales de botones
            updateButtonStyle('btn-led', data.led);
            updateButtonStyle('btn-motor', data.motor);
        });

        function updateButtonStyle(id, state) {
            const btn = document.getElementById(id);
            if (state === 1 || state === true || state === "ON") {
                btn.classList.add('glow-active');
            } else {
                btn.classList.remove('glow-active');
            }
        }

        // 3. ACCIONES
        function toggleActuator(name) {
            const ref = db.ref(`sistema/${name}`);
            ref.once('value').then((snapshot) => {
                const current = snapshot.val();
                const newValue = (current === 1) ? 0 : 1;
                ref.set(newValue);
                
                Swal.fire({
                    title: 'Comando enviado',
                    text: `${name.toUpperCase()} cambiado a ${newValue ? 'ON' : 'OFF'}`,
                    icon: 'success',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2000,
                    background: '#0f172a',
                    color: '#fff'
                });
            });
        }

        // 4. SEGURIDAD (Login simple)
        window.onload = () => {
            Swal.fire({
                title: 'Acceso Restringido',
                input: 'password',
                inputPlaceholder: 'Ingrese su contraseña',
                allowOutsideClick: false,
                background: '#0f172a',
                color: '#fff',
                confirmButtonColor: '#06b6d4',
                preConfirm: (pass) => {
                    if (pass === '1234') return 'admin';
                    if (pass === '4321') return 'operario';
                    Swal.showValidationMessage('Contraseña incorrecta');
                }
            }).then((result) => {
                Swal.fire({
                    icon: 'success',
                    title: `Bienvenido, ${result.value}`,
                    timer: 1500,
                    showConfirmButton: false,
                    background: '#0f172a',
                    color: '#fff'
                });
            });
        };
    </script>
</body>
</html>
